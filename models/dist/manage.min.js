"use strict";var mongoose=require("mongoose"),_require=require("mongoose"),model=_require.model,bcrypt=require("bcrypt"),user=require("./user"),question=require("./question"),branch=require("./branch"),answer=require("./answers");mongoose.set("strictQuery",!0);var branches=[];function getBranchDetails(s,i){branch.find(function(s,e){if(s)console.log(s);else{var n=[],o=[];(branches=e).forEach(function(s){o.indexOf(-1==s.branch)&&o.push(s.branch),s.subjects.forEach(function(s){-1==n.indexOf(s)&&n.push(s)})}),n.sort(),o.sort(),i.render("index",{data:e,subject:n})}})}function insert(s,n){var e=new user;e.username=s.body.username;var o=bcrypt.genSaltSync(10),i=bcrypt.hashSync(s.body.password,o);e.password=i,e.email=s.body.email,e.name=s.body.fullname,e.branch=s.body.branch,"Faculty"==s.body.userType&&(e.subject=s.body.subject),e.userType=s.body.userType,e.save(function(s,e){s?console.log(s):n.redirect("/")})}function login(i,u){var t=i.session;user.findOne({username:i.body.username},function(s,o){s?console.log(s):o.username==i.body.username?bcrypt.compare(i.body.password,o.password,function(s,e){if(s&&console.log(s),e)if(console.log(o.username+" LOGED IN"),"Faculty"===o.userType)t.userId=o.id,t.username=o.username,i.session.fullname=o.fullname,i.session.subject=o.subject,i.session.branch=o.branch,i.session.login=!0,u.redirect("/Faculty");else{var n=[];branches.forEach(function(s){s.branch==o.branch&&(n=s.subjects)}),i.session.subjects=n,i.session.userId=o.id,i.session.username=o.username,i.session.fullname=o.fullname,i.session.option=o.branch,i.session.login=!0,u.redirect("/Student")}else u.send("invalid password")}):u.send("invalid username or password")})}function serveFaculty(a,l){null!=a.session.login&&0!=a.session.login||l.send("<script>alert('Session no longer exists')<\/script>"),question.find({subject:a.session.subject},function(s,c){s?console.log(s):answer.find({subject:a.session.subject},function(s,e){if(s)console.log(s);else{a.session.questions=[],a.session.usersubmitions=[];for(var n=0;n<c.length;n++){var o=c[n].question;a.session.questions.push(o);for(var i=[],u=0;u<e.length;u++)if(e[u].question==o){var t={};t.username=e[u].username,t.answer=e[u].answer,t.question=e[u].question,i.push(t)}-1==a.session.usersubmitions.indexOf(i)&&a.session.usersubmitions.push(i)}var r={username:a.session.username,option:a.session.subject,questions:a.session.questions,usersubmitions:a.session.usersubmitions};l.render("faculty",r)}})})}function serveSubject(i,u){answer.find(function(s,o){s?console.log(s):question.find(function(s,e){if(s)console.log(s);else{null!=i.session.login&&0!=i.session.login||u.send("<script>alert('Session no longer exists')<\/script>"),i.session.subject=i.query.subject,i.session.questions=[];for(var n=0;n<e.length;n++)e[n].subject==i.session.subject&&-1==i.session.questions.indexOf(e[n].question)&&i.session.questions.push(e[n].question);i.session.answers=[],i.session.submitions=[],i.session.pending=[];for(n=0;n<o.length;n++)o[n].subject==i.session.subject&&o[n].username==i.session.username&&(-1==i.session.submitions.indexOf(o[n].question)&&i.session.submitions.push(o[n].question),-1==i.session.answers.indexOf(o[n].answer)&&i.session.answers.push(o[n].answer));i.session.questions.forEach(function(s){-1==i.session.submitions.indexOf(s)&&i.session.pending.push(s)}),u.render("subject",i.session)}})})}function submitAnswer(n,o){var s=new answer;s.username=n.session.username,s.subject=n.session.subject,s.question=n.body.question,s.answer=n.body.answer,s.save(function(s,e){s?console.log(s):o.redirect("/Subject?subject="+n.session.subject)})}function addQuestion(n,o){var i=new question;null!=n.session.login&&!1!==n.session.login||o.send("<script>alert('Session no longer exists')<\/script>"),i.subject=n.session.subject,i.question=n.body.question,i.save(function(s,e){s?console.log(s):(n.session.question=i.question,o.redirect("/Faculty"))})}function editQuestion(s,e){null!=s.session.login&&!1!==s.session.login||e.send("<script>alert('Session no longer exists')<\/script>"),question.findOneAndUpdate({question:s.body.oldquestion,subject:s.body.subject},{question:s.body.question_},function(s,e){s&&console.log(s)}),answer.updateMany({question:s.body.oldquestion,subject:s.body.subject},{question:s.body.question_},function(s,e){s&&console.log(s)}),e.redirect("/Faculty")}function deleteQuestion(s,e){null!=s.session.login&&!1!==s.session.login||e.send("<script>alert('Session no longer exists')<\/script>"),question.findOneAndRemove({question:s.body.question_del,subject:s.body.subject},function(s,e){s&&console.log(s)}),answer.deleteMany({question:s.body.question_del,subject:s.body.subject},function(s,e){s&&console.log(s)}),e.redirect("/Faculty")}module.exports={insert:insert,login:login,submitAnswer:submitAnswer,serveSubject:serveSubject,serveFaculty:serveFaculty,addQuestion:addQuestion,editQuestion:editQuestion,deleteQuestion:deleteQuestion,getBranchDetails:getBranchDetails,branches:branches};
//# sourceMappingURL=manage.min.js.map
